"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("zustand"),i=require("@100mslive/hms-video-store"),o=require("react-resize-detector");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n,a,s=r(e),l=r(t);function c(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(let o=0;o<i.length;o++)if(!Object.prototype.hasOwnProperty.call(t,i[o])||!Object.is(e[i[o]],t[i[o]]))return!1;return!0}(a=n||(n={}))[a.VERBOSE=0]="VERBOSE",a[a.DEBUG=1]="DEBUG",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.NONE=5]="NONE";class u{static v(e,...t){this.log(n.VERBOSE,e,...t)}static d(e,...t){this.log(n.DEBUG,e,...t)}static i(e,...t){this.log(n.INFO,e,...t)}static w(e,...t){this.log(n.WARN,e,...t)}static e(e,...t){this.log(n.ERROR,e,...t)}static log(e,t,...i){if(!(this.level.valueOf()>e.valueOf()))switch(e){case n.VERBOSE:console.log("HMSui-components: ",t,...i);break;case n.DEBUG:console.debug("HMSui-components: ",t,...i);break;case n.INFO:console.info("HMSui-components: ",t,...i);break;case n.WARN:console.warn("HMSui-components: ",t,...i);break;case n.ERROR:console.error("HMSui-components: ",t,...i)}}}u.level=n.VERBOSE;const d="It seems like you forgot to add your component within a top level HMSRoomProvider, please refer to 100ms react docs(https://docs.100ms.live/javascript/v2/features/integration#react-hooks) to check on the required steps for using this hook.";const h="undefined"!=typeof window,g=e.createContext(null),f=(v=g,(t,i=c)=>{t||u.w("fetching full store without passing any selector may have a heavy performance impact on your website.");const o=e.useContext(v);if(!o)throw new Error(d);return(0,o.store)(t,i)});var v;const p=function(t){return(i,o=c)=>{i||u.w("fetching full store without passing any selector may have a heavy performance impact on your website.");const r=e.useContext(t);if(!r)throw new Error(d);const n=r.statsStore;return null==n?void 0:n(i,o)}}(g),m=()=>{const t=e.useContext(g);if(!t)throw new Error(d);return t.store},y=()=>{const t=e.useContext(g);if(!t)throw new Error(d);return t.notifications},w=()=>{const t=e.useContext(g);if(!t)throw new Error(d);return t.actions},P=t=>{const i=e.useContext(g),[o,r]=e.useState(null);if(!i)throw new Error(d);return e.useEffect((()=>{if(!i.notifications)return;return i.notifications.onNotification((e=>{r(e)}),t)}),[i.notifications,t]),o};function S(e,t,i,o){return new(i||(i=Promise))((function(r,n){function a(e){try{l(o.next(e))}catch(e){n(e)}}function s(e){try{l(o.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))}const b=(e,t)=>u.e("react-sdk",t,e),k=(e,t,i)=>S(void 0,void 0,void 0,(function*(){if(t)try{yield e.setRemoteTrackEnabled(t.id,!t.enabled)}catch(e){i(e,"remoteToggle")}})),E=({elements:e,tilesInFirstPage:t,onlyOnePage:i,isLastPageDifferentFromFirstPage:o,defaultWidth:r,defaultHeight:n,lastPageWidth:a,lastPageHeight:s})=>{const l=((e,t,i)=>e.reduce(((e,o,r)=>{const n=Math.floor(r/t);return n>0&&i||(e[n]||(e[n]=[]),e[n].push(o)),e}),[]))(e,t,i);return l.map(((e,t)=>e.map((e=>{const i=t===l.length-1,c=o&&i?a:r,u=o&&i?s:n;return Object.assign(Object.assign({},e),{height:u,width:c})}))))};const R=(e,t,i,o,r)=>{if(e<0||t<0)throw new Error("Container must have a non-negative area");if(i<1||!Number.isInteger(i))throw new Error("Number of shapes to place must be a positive integer");const n=o&&r&&o/r;if(void 0!==n&&isNaN(n))throw new Error("Aspect ratio must be a number");let a={area:0,cols:0,rows:0,width:0,height:0};if(void 0!==n)for(let o=i;o>0;o+=-1){const r=Math.ceil(i/o);let s,l;e/(o*n)<=t/r?(s=e/o,l=s/n):(l=t/r,s=l*n);const c=s*l;c>a.area&&(a={area:c,width:s,height:l,rows:r,cols:o})}return a};function M({count:e,parentWidth:t,parentHeight:i,maxTileCount:o,maxRowCount:r,maxColCount:n,aspectRatio:a}){let s=0,l=0,c=0,u=0,d=!1,h=0;if(0===e)return{tilesInFirstPage:h,defaultWidth:s,defaultHeight:l,lastPageWidth:c,lastPageHeight:u,isLastPageDifferentFromFirstPage:d};if(o)({tilesInFirstPage:h,defaultWidth:s,defaultHeight:l,lastPageWidth:c,lastPageHeight:u,isLastPageDifferentFromFirstPage:d}=(({parentWidth:e,parentHeight:t,count:i,maxCount:o,aspectRatio:r})=>{let n=0,a=0,s=0,l=0,c=!1,u=0,d=0;const{width:h,height:g}=R(e,t,Math.min(i,o),r.width,r.height);if(n=h,a=g,u=Math.min(i,o),d=i%o,c=d>0&&i>o,c){const{width:i,height:o}=R(e,t,d,r.width,r.height);s=i,l=o}return{tilesInFirstPage:u,defaultWidth:n,defaultHeight:a,lastPageWidth:s,lastPageHeight:l,isLastPageDifferentFromFirstPage:c}})({parentWidth:t,parentHeight:i,count:e,maxCount:o,aspectRatio:a}));else if(r)({tilesInFirstPage:h,defaultWidth:s,defaultHeight:l,lastPageWidth:c,lastPageHeight:u,isLastPageDifferentFromFirstPage:d}=(({parentWidth:e,parentHeight:t,count:i,maxCount:o,aspectRatio:r})=>{let n=0,a=0,s=0,l=0,c=!1,u=0,d=0;const h=Math.min(Math.ceil(Math.sqrt(i*(r.width/r.height)/(e/t))),o),g=t/h,f=g*(r.width/r.height),v=Math.floor(e/f);if(n=f,a=g,u=Math.min(i,h*v),d=i%(h*v),c=d>0&&i>h*v,c){const i=t/Math.min(Math.ceil(Math.sqrt(d*(r.width/r.height)/(e/t))),o);l=i,s=i*(r.width/r.height)}return{tilesInFirstPage:u,defaultWidth:n,defaultHeight:a,lastPageWidth:s,lastPageHeight:l,isLastPageDifferentFromFirstPage:c}})({parentWidth:t,parentHeight:i,count:e,maxCount:r,aspectRatio:a}));else if(n)({tilesInFirstPage:h,defaultWidth:s,defaultHeight:l,lastPageWidth:c,lastPageHeight:u,isLastPageDifferentFromFirstPage:d}=(({parentWidth:e,parentHeight:t,count:i,maxCount:o,aspectRatio:r})=>{let n=0,a=0,s=0,l=0,c=!1,u=0,d=0;const h=Math.min(Math.ceil(Math.sqrt(i*(e/t)/(r.width/r.height))),o);let g=e/h,f=g/(r.width/r.height);f>t&&(f=t,g=f/(r.height/r.width));const v=Math.floor(t/f);if(a=f,n=g,u=Math.min(i,v*h),d=i%(v*h),c=d>0&&i>v*h,c){let i=e/Math.min(Math.ceil(Math.sqrt(d*(e/t)/(r.width/r.height))),o),n=i/(r.width/r.height);n>t&&(n=t,i=n/(r.height/r.width)),l=n,s=i}return{tilesInFirstPage:u,defaultWidth:n,defaultHeight:a,lastPageWidth:s,lastPageHeight:l,isLastPageDifferentFromFirstPage:c}})({parentWidth:t,parentHeight:i,count:e,maxCount:n,aspectRatio:a}));else{const{width:o,height:r}=R(t,i,e,a.width,a.height);s=o,l=r,h=e}return{tilesInFirstPage:h,defaultWidth:s,defaultHeight:l,lastPageWidth:c,lastPageHeight:u,isLastPageDifferentFromFirstPage:d}}const I={width:1,height:1};exports.HMSRoomProvider=({children:t,actions:o,store:r,notifications:n,stats:a,isHMSStatsOn:c=!1,leaveOnUnload:u=!0})=>{const d=e.useMemo((()=>{let e;const t=()=>{throw new Error("modifying store is not allowed")};if(o&&r)e={actions:o,store:l.default(Object.assign(Object.assign({},r),{setState:t,destroy:t}))},n&&(e.notifications=n),a&&(e.statsStore=l.default({getState:a.getState,subscribe:a.subscribe,setState:t,destroy:t}));else{const o=new i.HMSReactiveStore;if(e={actions:o.getActions(),store:l.default(Object.assign(Object.assign({},o.getStore()),{setState:t,destroy:t})),notifications:o.getNotifications()},c){const i=o.getStats();e.statsStore=l.default({getState:i.getState,subscribe:i.subscribe,setState:t,destroy:t})}}return e.actions.setFrameworkInfo({type:"react-web",version:s.default.version,sdkVersion:"0.8.3"}),e}),[o,r,n,a,c]);return e.useEffect((()=>{if(h&&u){const e=()=>d.actions.leave();return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}return()=>{}}),[u,d]),s.default.createElement(g.Provider,{value:d},t)},exports.throwErrorHandler=e=>{throw e},exports.useAVToggle=(t=b)=>{const o=f(i.selectIsLocalAudioEnabled),r=f(i.selectIsLocalVideoEnabled),n=f(i.selectIsInPreview)?i.selectIsAllowedToPreviewMedia:i.selectIsAllowedToPublish,a=f(n),s=w(),l=e.useCallback((()=>S(void 0,void 0,void 0,(function*(){try{yield s.setLocalAudioEnabled(!o)}catch(e){t(e,"toggleAudio")}}))),[s,o,t]),c=e.useCallback((()=>S(void 0,void 0,void 0,(function*(){try{yield s.setLocalVideoEnabled(!r)}catch(e){t(e,"toggleVideo")}}))),[s,r,t]);return{isLocalAudioEnabled:o,isLocalVideoEnabled:r,toggleAudio:(null==a?void 0:a.audio)?l:void 0,toggleVideo:(null==a?void 0:a.video)?c:void 0}},exports.useAudioLevelStyles=function({trackId:t,getStyle:o,ref:r}){const n=m();e.useEffect((()=>n.subscribe((e=>{if(!r.current)return;const t=o(e);for(const e in t)r.current.style[e]=t[e]}),i.selectTrackAudioByID(t))),[o,r,n,t])},exports.useAutoplayError=()=>{const t=P(i.HMSNotificationTypes.ERROR),[o,r]=e.useState(""),n=w(),a=e.useCallback((()=>S(void 0,void 0,void 0,(function*(){yield n.unblockAudio()}))),[n]);return e.useEffect((()=>{3008===(null==t?void 0:t.data.code)&&r(null==t?void 0:t.data.message)}),[t]),{error:o,unblockAudio:a,resetError:()=>r("")}},exports.useCustomEvent=({type:t,json:o=!0,onEvent:r,handleError:n=b})=>{const a=w(),s=y();e.useEffect((()=>{a.ignoreMessageTypes([t])}),[a,t]),e.useEffect((()=>{if(!s)return;return s.onNotification((e=>{const i=e.data;if(i&&i.type===t)try{const e=o?JSON.parse(i.message):i.message;null==r||r(e)}catch(e){n(e,"handleCustomEvent")}}),i.HMSNotificationTypes.NEW_MESSAGE)}),[s,t,o,r,n]);return{sendEvent:e.useCallback(((e,i)=>S(void 0,void 0,void 0,(function*(){try{const n=((e,t)=>t?JSON.stringify(e||""):e)(e,o);i&&Array.isArray(null==i?void 0:i.roleNames)?yield a.sendGroupMessage(n,i.roleNames,t):"string"==typeof(null==i?void 0:i.peerId)?yield a.sendDirectMessage(n,i.peerId,t):yield a.sendBroadcastMessage(n,t),null==r||r(e)}catch(e){n(e,"sendCustomEvent")}}))),[a,n,r,t,o])}},exports.useDevices=(t=b)=>{const o=w(),r=f(i.selectDevices),n=f(i.selectLocalMediaSettings),a=f(i.selectIsAllowedToPublish),s={[i.DeviceType.audioOutput]:n.audioOutputDeviceId},l={[i.DeviceType.audioOutput]:r.audioOutput};a.video&&(l[i.DeviceType.videoInput]=r.videoInput,s[i.DeviceType.videoInput]=n.videoInputDeviceId),a.audio&&(l[i.DeviceType.audioInput]=r.audioInput,s[i.DeviceType.audioInput]=n.audioInputDeviceId);return{allDevices:l,selectedDeviceIDs:s,updateDevice:e.useCallback((({deviceType:e,deviceId:r})=>S(void 0,void 0,void 0,(function*(){try{switch(e){case i.DeviceType.audioInput:yield o.setAudioSettings({deviceId:r});break;case i.DeviceType.videoInput:yield o.setVideoSettings({deviceId:r});break;case i.DeviceType.audioOutput:yield o.setAudioOutputDevice(r)}}catch(e){t(e,"updateDevices")}}))),[t,o])}},exports.useHMSActions=w,exports.useHMSNotifications=P,exports.useHMSStatsStore=p,exports.useHMSStore=f,exports.useHMSVanillaNotifications=y,exports.useHMSVanillaStore=m,exports.useParticipantList=()=>{const t=f(i.selectIsConnectedToRoom),o=f(t?i.selectPeers:i.selectRemotePeers),r=f(i.selectPeerCount),n=e.useMemo((()=>{return(e=o)&&Array.isArray(e)&&0!==e.length?e.reduce(((e,t)=>t.roleName?(e[t.roleName]||(e[t.roleName]=[]),e[t.roleName].push(t),e):e),{}):{};var e}),[o]);return{roles:Object.keys(n),participantsByRoles:n,peerCount:r,isConnected:t}},exports.useParticipants=e=>{var t;const o=f(i.selectIsConnectedToRoom),r=f(i.selectPeerCount),n=f(i.selectAvailableRoleNames);let a=f(o?i.selectPeers:i.selectRemotePeers);const s=Array.from(new Set(a.map((e=>e.roleName)))),l=m();if((null===(t=null==e?void 0:e.metadata)||void 0===t?void 0:t.isHandRaised)&&(a=a.filter((e=>l.getState(i.selectPeerMetadata(e.id)).isHandRaised))),(null==e?void 0:e.role)&&n.includes(e.role)&&(a=a.filter((t=>t.roleName===e.role))),null==e?void 0:e.search){const t=e.search.toLowerCase();a=a.filter((e=>{var i;return(null===(i=e.roleName)||void 0===i?void 0:i.toLowerCase().includes(t))||e.name.toLowerCase().includes(t)}))}return{participants:a,isConnected:o,peerCount:r,rolesWithParticipants:s}},exports.usePreviewJoin=({name:t="",token:o,metadata:r,handleError:n=b,initEndpoint:a,initialSettings:s,captureNetworkQualityInPreview:l,asRole:c,autoManageVideo:u,autoManageWakeLock:d})=>{const h=w(),g=f(i.selectRoomState),v=f(i.selectIsConnectedToRoom)||!1,p=g===i.HMSRoomState.Preview,m=e.useMemo((()=>({userName:t,authToken:o,metaData:r,rememberDeviceSelection:!0,settings:s,initEndpoint:a,asRole:c,captureNetworkQualityInPreview:l,autoManageVideo:u,autoManageWakeLock:d})),[t,o,r,a,s,l,c,u,d]),y=e.useCallback((()=>S(void 0,void 0,void 0,(function*(){if(o&&g===i.HMSRoomState.Disconnected){v&&(yield h.leave());try{yield h.preview(m)}catch(e){n(e,"preview")}}}))),[h,n,o,g,m,v]);return{enableJoin:p,join:e.useCallback((()=>S(void 0,void 0,void 0,(function*(){if(o)try{yield h.join(m)}catch(e){n(e,"join")}}))),[h,m,n,o]),isConnected:v,preview:y}},exports.useRecordingStreaming=()=>{const e=f(i.selectRecordingState),t=f(i.selectRTMPState),o=f(i.selectHLSState),r=e.server.running,n=e.browser.running,a=e.hls.running,s=r||n||a;return{isServerRecordingOn:r,isBrowserRecordingOn:n,isHLSRecordingOn:a,isStreamingOn:o.running||t.running,isHLSRunning:o.running,isRTMPRunning:t.running,isRecordingOn:s}},exports.useRemoteAVToggle=(t,o,r=b)=>{const n=w(),a=f(i.selectAudioTrackByID(t)),s=f(i.selectVideoTrackByID(o)),l=f(i.selectAudioTrackVolume(null==a?void 0:a.id)),c=f(i.selectPermissions),u=(null==s?void 0:s.enabled)?null==c?void 0:c.mute:null==c?void 0:c.unmute,d=(null==a?void 0:a.enabled)?null==c?void 0:c.mute:null==c?void 0:c.unmute,h=e.useCallback((()=>S(void 0,void 0,void 0,(function*(){yield k(n,a,r)}))),[n,a,r]),g=e.useCallback((()=>S(void 0,void 0,void 0,(function*(){yield k(n,s,r)}))),[n,r,s]),v=e.useCallback((e=>{a&&n.setVolume(e,a.id)}),[n,a]);return{isAudioEnabled:!!(null==a?void 0:a.enabled),isVideoEnabled:!!(null==s?void 0:s.enabled),volume:l,toggleAudio:a&&d?h:void 0,toggleVideo:"regular"===(null==s?void 0:s.source)&&u?g:void 0,setVolume:a?v:void 0}},exports.useScreenShare=(t=b)=>{var o,r;const n=w(),a=f(i.selectIsLocalScreenShared),s=f(i.selectPeerScreenSharing),l=f(i.selectScreenSharesByPeerId(null==s?void 0:s.id)),c=e.useCallback((e=>S(void 0,void 0,void 0,(function*(){try{yield n.setScreenShareEnabled(!a,e)}catch(e){t(e,"toggleScreenShare")}}))),[n,a,t]);return{amIScreenSharing:a,screenSharingPeerId:null==s?void 0:s.id,screenSharingPeerName:null==s?void 0:s.name,screenShareVideoTrackId:null===(o=null==l?void 0:l.video)||void 0===o?void 0:o.id,screenShareAudioTrackId:null===(r=null==l?void 0:l.audio)||void 0===r?void 0:r.id,toggleScreenShare:c}},exports.useVideo=({trackId:t,attach:o})=>{const r=w(),n=e.useRef(null),a=f(i.selectVideoTrackByID(t)),s=e.useRef(),l=e.useCallback((e=>{e&&(n.current=e)}),[]);return e.useEffect((()=>{s.current?(null==a?void 0:a.id)&&s.current!==(null==a?void 0:a.id)&&S(void 0,void 0,void 0,(function*(){if(n.current)try{u.d("detaching because different track is passed"),yield r.detachVideo(s.current,n.current)}catch(e){u.w("detach video error for track",s.current,e)}})):s.current=null==a?void 0:a.id}),[null==a?void 0:a.id,r]),e.useEffect((()=>{S(void 0,void 0,void 0,(function*(){(null==a?void 0:a.id)&&n.current&&(!1!==o?yield r.attachVideo(a.id,n.current):yield r.detachVideo(a.id,n.current))}))}),[a,o,r]),e.useEffect((()=>()=>{S(void 0,void 0,void 0,(function*(){if(n.current&&a)try{yield r.detachVideo(a.id,n.current)}catch(e){u.w("detach video error for track",a.id,e)}}))}),[]),{videoRef:l}},exports.useVideoList=({peers:t,maxTileCount:r,maxColCount:n,maxRowCount:a,includeScreenShareForPeer:s=(()=>!1),aspectRatio:l=I,filterNonPublishingPeers:c=!0,offsetY:u=0})=>{const{width:d=0,height:h=0,ref:g}=o.useResizeDetector(),f=((e,t,i,o=!0)=>{if(!e||!t||!i)return[];const r=[];for(const n of e)if(void 0===n.videoTrack&&n.audioTrack&&t[n.audioTrack]?r.push({peer:n}):n.videoTrack&&t[n.videoTrack]?r.push({track:t[n.videoTrack],peer:n}):o||r.push({peer:n}),n.auxiliaryTracks.length>0&&n.auxiliaryTracks.forEach((e=>{const i=t[e];"video"===(null==i?void 0:i.type)&&"regular"===(null==i?void 0:i.source)&&r.push({track:i,peer:n})})),i(n)&&n.auxiliaryTracks.length>0){const e=n.auxiliaryTracks.find((e=>{const i=t[e];return"video"===(null==i?void 0:i.type)&&"screen"===(null==i?void 0:i.source)}));e&&r.push({track:t[e],peer:n})}return r})(t,m().getState(i.selectTracksMap),s,c),v=e.useMemo((()=>{if(l)return l;return{width:function(e){if(0===e.length)return null;const t={};let i=e[0],o=1;for(let r=0;r<e.length;r++){const n=e[r];null===t[n]?t[n]=1:t[n]++,t[n]>o&&(i=n,o=t[n])}return i}(f.filter((e=>{var t,i;return(null===(t=e.track)||void 0===t?void 0:t.width)&&(null===(i=e.track)||void 0===i?void 0:i.height)})).map((e=>{var t,i;return((null===(t=e.track)||void 0===t?void 0:t.width)||1)/((null===(i=e.track)||void 0===i?void 0:i.height)||1)})))||1,height:1}}),[l,f]),p=f.length,{tilesInFirstPage:y,defaultWidth:w,defaultHeight:P,lastPageWidth:S,lastPageHeight:b,isLastPageDifferentFromFirstPage:k}=e.useMemo((()=>M({count:p,parentWidth:Math.floor(d),parentHeight:Math.floor(h)-Math.min(h,u),maxTileCount:r,maxRowCount:a,maxColCount:n,aspectRatio:v})),[p,d,h,r,a,n,v,u]);return{pagesWithTiles:e.useMemo((()=>E({elements:f,tilesInFirstPage:y,onlyOnePage:!1,isLastPageDifferentFromFirstPage:k,defaultWidth:w,defaultHeight:P,lastPageWidth:S,lastPageHeight:b})),[f,y,k,w,P,S,b]),ref:g}},Object.keys(i).forEach((function(e){"default"===e||exports.hasOwnProperty(e)||Object.defineProperty(exports,e,{enumerable:!0,get:function(){return i[e]}})}));
//# sourceMappingURL=index.cjs.js.map
