{
  "version": 3,
  "sources": ["../src/index.ts", "../src/adapters/HlsJsAdapter.ts", "../src/adapters/BaseAdapter.ts", "../src/controllers/HlsStats.ts"],
  "sourcesContent": ["export { HlsStats } from './controllers/HlsStats';\nexport type { IHlsStats } from './interfaces/IHlsStats';\nexport type { HlsPlayerStats } from './interfaces/index';\n", "import Hls from 'hls.js';\nimport { BaseAdapter } from './BaseAdapter';\n\nexport class HlsJsAdapter extends BaseAdapter {\n  timeUpdateHandler = () => {\n    const bufferedDuration =\n      this.videoEl.buffered.length > 0 ? this.videoEl.buffered.end(0) - this.videoEl.buffered.start(0) : 0;\n    const distanceFromLive =\n      (this.hlsInstance.liveSyncPosition ? this.hlsInstance.liveSyncPosition - this.videoEl.currentTime : 0) * 1000;\n    const quality = this.videoEl.getVideoPlaybackQuality();\n    const droppedFrames = quality.droppedVideoFrames;\n    this.hlsStatsState = {\n      ...this.hlsStatsState,\n      distanceFromLive: distanceFromLive > 0 ? distanceFromLive : 0,\n      bufferedDuration,\n      droppedFrames,\n    };\n  };\n\n  levelLoadedHandler = (_: any, { level }: { level: number }) => {\n    const currentLevel = this.hlsInstance.levels[level];\n    const { bitrate, height, width } = currentLevel;\n    this.hlsStatsState = {\n      ...this.hlsStatsState,\n      bitrate,\n      videoSize: {\n        height,\n        width,\n      },\n    };\n  };\n\n  fragChangedHandler = (_: any, { frag }: { frag: { stats: { bwEstimate: number }; baseurl: string } }) => {\n    const { stats, baseurl } = frag;\n    const { bwEstimate } = stats;\n    this.hlsStatsState = {\n      ...this.hlsStatsState,\n      bandwidthEstimate: bwEstimate,\n      url: baseurl,\n    };\n  };\n\n  startGatheringStats(): void {\n    this.hlsInstance.on(Hls.Events.FRAG_CHANGED, this.fragChangedHandler);\n    this.hlsInstance.on(Hls.Events.LEVEL_LOADED, this.levelLoadedHandler);\n    this.videoEl.addEventListener('timeupdate', this.timeUpdateHandler);\n  }\n\n  finishGatheringStats(): void {\n    this.videoEl.removeEventListener('timeupdate', this.timeUpdateHandler);\n    this.hlsInstance.off(Hls.Events.FRAG_CHANGED, this.fragChangedHandler);\n    this.hlsInstance.off(Hls.Events.LEVEL_LOADED, this.levelLoadedHandler);\n  }\n}\n", "import Hls from 'hls.js';\nimport { HlsPlayerStats } from '../interfaces';\nexport abstract class BaseAdapter {\n  hlsInstance: Hls;\n  videoEl: HTMLVideoElement;\n  hlsStatsState: HlsPlayerStats = {};\n  constructor(hlsInstance: Hls, videoEl: HTMLVideoElement) {\n    this.hlsInstance = hlsInstance;\n    this.videoEl = videoEl;\n  }\n  abstract startGatheringStats(): void;\n  abstract finishGatheringStats(): void;\n  getState() {\n    return this.hlsStatsState;\n  }\n}\n", "import Hls from 'hls.js';\nimport { BaseAdapter } from '../adapters/BaseAdapter';\nimport { HlsJsAdapter } from '../adapters/HlsJsAdapter';\nimport { HlsPlayerStats } from '../interfaces';\nimport { IHlsStats } from '../interfaces/IHlsStats';\n\nexport class HlsStats implements IHlsStats {\n  adapter: BaseAdapter;\n  intervalFunctionId = -1;\n  constructor(hlsLibraryInstance: Hls, videoEl: HTMLVideoElement) {\n    const hlsJsAdapter = new HlsJsAdapter(hlsLibraryInstance, videoEl);\n    this.adapter = hlsJsAdapter;\n  }\n\n  subscribe = (callback: (state: HlsPlayerStats) => void, interval = 2000) => {\n    this.adapter.startGatheringStats();\n    //@ts-ignore\n    this.intervalFunctionId = setInterval(() => {\n      callback(this.getState());\n    }, interval);\n    return this.unsubscribe;\n  };\n  unsubscribe = () => {\n    clearInterval(this.intervalFunctionId);\n    this.adapter.finishGatheringStats();\n  };\n\n  getState = () => {\n    return this.adapter.getState();\n  };\n}\n"],
  "mappings": "s6BAAA,4BCAA,MAAgB,qBCET,WAA2B,CAIhC,YAAY,EAAkB,EAA2B,CADzD,mBAAgC,GAE9B,KAAK,YAAc,EACnB,KAAK,QAAU,EAIjB,UAAW,CACT,MAAO,MAAK,gBDVT,mBAA2B,EAAY,CAAvC,aAHP,CAGO,oBACL,uBAAoB,IAAM,CACxB,GAAM,GACJ,KAAK,QAAQ,SAAS,OAAS,EAAI,KAAK,QAAQ,SAAS,IAAI,GAAK,KAAK,QAAQ,SAAS,MAAM,GAAK,EAC/F,EACH,MAAK,YAAY,iBAAmB,KAAK,YAAY,iBAAmB,KAAK,QAAQ,YAAc,GAAK,IAErG,EAAgB,AADN,KAAK,QAAQ,0BACC,mBAC9B,KAAK,cAAgB,OAChB,KAAK,eADW,CAEnB,iBAAkB,EAAmB,EAAI,EAAmB,EAC5D,mBACA,mBAIJ,wBAAqB,CAAC,EAAQ,CAAE,WAA+B,CAC7D,GAAM,GAAe,KAAK,YAAY,OAAO,GACvC,CAAE,UAAS,SAAQ,SAAU,EACnC,KAAK,cAAgB,OAChB,KAAK,eADW,CAEnB,UACA,UAAW,CACT,SACA,YAKN,wBAAqB,CAAC,EAAQ,CAAE,UAAyE,CACvG,GAAM,CAAE,QAAO,WAAY,EACrB,CAAE,cAAe,EACvB,KAAK,cAAgB,OAChB,KAAK,eADW,CAEnB,kBAAmB,EACnB,IAAK,KAIT,qBAA4B,CAC1B,KAAK,YAAY,GAAG,UAAI,OAAO,aAAc,KAAK,oBAClD,KAAK,YAAY,GAAG,UAAI,OAAO,aAAc,KAAK,oBAClD,KAAK,QAAQ,iBAAiB,aAAc,KAAK,mBAGnD,sBAA6B,CAC3B,KAAK,QAAQ,oBAAoB,aAAc,KAAK,mBACpD,KAAK,YAAY,IAAI,UAAI,OAAO,aAAc,KAAK,oBACnD,KAAK,YAAY,IAAI,UAAI,OAAO,aAAc,KAAK,sBE7ChD,WAAoC,CAGzC,YAAY,EAAyB,EAA2B,CADhE,wBAAqB,GAMrB,eAAY,CAAC,EAA2C,EAAW,MACjE,MAAK,QAAQ,sBAEb,KAAK,mBAAqB,YAAY,IAAM,CAC1C,EAAS,KAAK,aACb,GACI,KAAK,aAEd,iBAAc,IAAM,CAClB,cAAc,KAAK,oBACnB,KAAK,QAAQ,wBAGf,cAAW,IACF,KAAK,QAAQ,WAlBpB,GAAM,GAAe,GAAI,GAAa,EAAoB,GAC1D,KAAK,QAAU",
  "names": []
}
