var u=Object.create;var r=Object.defineProperty,E=Object.defineProperties,b=Object.getOwnPropertyDescriptor,g=Object.getOwnPropertyDescriptors,I=Object.getOwnPropertyNames,p=Object.getOwnPropertySymbols,L=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var v=(e,t,s)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,l=(e,t)=>{for(var s in t||(t={}))S.call(t,s)&&v(e,s,t[s]);if(p)for(var s of p(t))y.call(t,s)&&v(e,s,t[s]);return e},o=(e,t)=>E(e,g(t)),f=e=>r(e,"__esModule",{value:!0});var A=(e,t)=>{f(e);for(var s in t)r(e,s,{get:t[s],enumerable:!0})},G=(e,t,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of I(t))!S.call(e,a)&&a!=="default"&&r(e,a,{get:()=>t[a],enumerable:!(s=b(t,a))||s.enumerable});return e},F=e=>G(f(r(e!=null?u(L(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);A(exports,{HlsStats:()=>m});var n=F(require("hls.js"));var h=class{constructor(t,s){this.hlsStatsState={};this.hlsInstance=t,this.videoEl=s}getState(){return this.hlsStatsState}};var c=class extends h{constructor(){super(...arguments);this.timeUpdateHandler=()=>{let t=this.videoEl.buffered.length>0?this.videoEl.buffered.end(0)-this.videoEl.buffered.start(0):0,s=(this.hlsInstance.liveSyncPosition?this.hlsInstance.liveSyncPosition-this.videoEl.currentTime:0)*1e3,i=this.videoEl.getVideoPlaybackQuality().droppedVideoFrames;this.hlsStatsState=o(l({},this.hlsStatsState),{distanceFromLive:s>0?s:0,bufferedDuration:t,droppedFrames:i})};this.levelLoadedHandler=(t,{level:s})=>{let a=this.hlsInstance.levels[s],{bitrate:i,height:d,width:H}=a;this.hlsStatsState=o(l({},this.hlsStatsState),{bitrate:i,videoSize:{height:d,width:H}})};this.fragChangedHandler=(t,{frag:s})=>{let{stats:a,baseurl:i}=s,{bwEstimate:d}=a;this.hlsStatsState=o(l({},this.hlsStatsState),{bandwidthEstimate:d,url:i})}}startGatheringStats(){this.hlsInstance.on(n.default.Events.FRAG_CHANGED,this.fragChangedHandler),this.hlsInstance.on(n.default.Events.LEVEL_LOADED,this.levelLoadedHandler),this.videoEl.addEventListener("timeupdate",this.timeUpdateHandler)}finishGatheringStats(){this.videoEl.removeEventListener("timeupdate",this.timeUpdateHandler),this.hlsInstance.off(n.default.Events.FRAG_CHANGED,this.fragChangedHandler),this.hlsInstance.off(n.default.Events.LEVEL_LOADED,this.levelLoadedHandler)}};var m=class{constructor(t,s){this.intervalFunctionId=-1;this.subscribe=(t,s=2e3)=>(this.adapter.startGatheringStats(),this.intervalFunctionId=setInterval(()=>{t(this.getState())},s),this.unsubscribe);this.unsubscribe=()=>{clearInterval(this.intervalFunctionId),this.adapter.finishGatheringStats()};this.getState=()=>this.adapter.getState();let a=new c(t,s);this.adapter=a}};
//# sourceMappingURL=index.cjs.js.map
