import e,{Fragment as l}from"react";import{selectHMSStats as t,useHMSStatsStore as a,useHMSStore as o,selectConnectionQualityByPeerID as r,simulcastMapping as n}from"@100mslive/react-sdk";import{formatBytes as i}from"./formatBytes.js";import{Stats as u}from"./StyledStats.js";import{Tooltip as d}from"../Tooltip/Tooltip.js";function c({videoTrackID:d,audioTrackID:c,peerID:m,isLocal:E=!1}){var h,f,w;const S=E?t.localAudioTrackStatsByID:t.trackStatsByID,k=a(S(c)),g=a(t.localVideoTrackStatsByID(d)),B=a(t.trackStatsByID(d)),D=E?null==g?void 0:g[0]:B,$=null===(h=o(r(m)))||void 0===h?void 0:h.downlinkQuality,y=a(t.availablePublishBitrate);return k||D?e.createElement(u.Root,null,e.createElement("table",null,e.createElement("tbody",null,E?e.createElement(l,null,e.createElement(v,{show:b(y),label:"AOBR",tooltip:"Available Outgoing Bitrate",value:i(y,"b/s")}),null==g?void 0:g.map((t=>{var a,o;if(!t)return null;const r=t.rid?n[t.rid]:"";return e.createElement(l,null,r&&e.createElement(v,{label:r.toUpperCase(),value:""}),e.createElement(v,{show:b(t.frameWidth),label:"Width",value:null===(a=t.frameWidth)||void 0===a?void 0:a.toString()}),e.createElement(v,{show:b(t.frameHeight),label:"Height",value:null===(o=t.frameHeight)||void 0===o?void 0:o.toString()}),e.createElement(v,{show:b(t.framesPerSecond),label:"FPS",value:`${t.framesPerSecond} ${b(t.framesDropped)?`(${t.framesDropped} dropped)`:""}`}),e.createElement(v,{show:p(t.bitrate),label:"Bitrate(V)",value:i(t.bitrate,"b/s")}),e.createElement(u.Gap,null))}))):e.createElement(l,null,e.createElement(v,{show:b(null==D?void 0:D.frameWidth),label:"Width",value:null===(f=null==D?void 0:D.frameWidth)||void 0===f?void 0:f.toString()}),e.createElement(v,{show:b(null==D?void 0:D.frameHeight),label:"Height",value:null===(w=null==D?void 0:D.frameHeight)||void 0===w?void 0:w.toString()}),e.createElement(v,{show:b(null==D?void 0:D.framesPerSecond),label:"FPS",value:`${null==D?void 0:D.framesPerSecond} ${b(null==D?void 0:D.framesDropped)?`(${null==D?void 0:D.framesDropped} dropped)`:""}`}),e.createElement(v,{show:p(null==D?void 0:D.bitrate),label:"Bitrate(V)",value:i(null==D?void 0:D.bitrate,"b/s")})),e.createElement(v,{show:p(null==k?void 0:k.bitrate),label:"Bitrate(A)",value:i(null==k?void 0:k.bitrate,"b/s")}),e.createElement(v,{show:p($),label:"Downlink",value:`${$}`}),e.createElement(v,{show:p(null==D?void 0:D.codec),label:"Codec(V)",value:null==D?void 0:D.codec}),e.createElement(v,{show:p(null==k?void 0:k.codec),label:"Codec(A)",value:null==k?void 0:k.codec}),e.createElement(s,{audioTrackStats:k,videoTrackStats:D})))):null}const s=({audioTrackStats:l,videoTrackStats:t})=>{var a,o;const r=(null==l?void 0:l.type.includes("outbound"))||(null==t?void 0:t.type.includes("outbound")),n=r?null==l?void 0:l.remote:l,i=r?null==t?void 0:t.remote:t;return e.createElement(e.Fragment,null,e.createElement(m,{label:"Packet Loss(V)",stats:i}),e.createElement(m,{label:"Packet Loss(A)",stats:n}),e.createElement(v,{show:p(null==i?void 0:i.jitter),label:"Jitter(V)",value:null===(a=null==i?void 0:i.jitter)||void 0===a?void 0:a.toFixed(4)}),e.createElement(v,{show:p(null==n?void 0:n.jitter),label:"Jitter(A)",value:null===(o=null==n?void 0:n.jitter)||void 0===o?void 0:o.toFixed(4)}))},m=({stats:l,label:t})=>{const a=`${(null==l?void 0:l.packetsLostRate)?l.packetsLostRate.toFixed(2):0}/s`;return e.createElement(v,{show:b(null==l?void 0:l.packetsLost),label:t,value:`${null==l?void 0:l.packetsLost}(${a})`})},v=e.memo((({label:l="",value:t="",tooltip:a="",show:o=!0})=>{const r=e.createElement(u.Label,{css:{fontWeight:t?"$regular":"$semiBold"}},l);return e.createElement(e.Fragment,null,o?e.createElement(u.Row,null,a?e.createElement(d,{side:"top",title:a},r):r,""===t?e.createElement(u.Value,null):e.createElement(u.Value,null,t)):null)}));function b(e){return p(e)&&0!==e}function p(e){return null!=e}export{c as VideoTileStats,p as isNotNullish,b as isNotNullishAndNot0};
//# sourceMappingURL=Stats.js.map
